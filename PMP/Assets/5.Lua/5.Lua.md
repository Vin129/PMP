## LuaSkills

### 1.安全访问操作符 ？

```lua
a?.b
--当a为nil时候 结果会是nil而不会报错
```

















## ToLua

### 简介

​	ToLua基于LuaInterface，LuaInterface是一个实现lua和微软.Net平台的CLR混合编程的开源库，使得lua脚本可以实例化CLR对象，访问属性，调用方法甚至使用lua函数来处理事件。ToLua保留了LuaInterface基本形式，重写或移除了部分内容，使代码更加简洁，提供了对Unity的支持、拓展了lua5.1.4源码。而最大的改进在于，LuaInterface中lua访问CLR需要运行时反射，对于游戏应用来说效率不够理想，ToLua则提供了一套中间层导出工具，对于需要访问的CLR、Unity及自定义类预生成wrap文件，lua访问时只访问wrap文件，wrap文件接收lua传递来的参数，进行类型（值、对象、委托）转换，再调用真正工作的CLR对象和函数，最后将返回值返回给lua，有效地提高了效率。

### **核心功能及文件**

提供Lua-c#值类型、对象类型转化操作交互层。（ObjectTranslator.cs、LuaFunction.cs、LuaTable.cs、ToLua.cs等）提供Lua虚拟机创建、启动、销毁，Require、DoFile、DoString、Traceback等相关支持。（LuaState.cs、LuaStatic.cs）提供导出工具，利用c#反射，对指定的c#类生成对应的wrap文件，启动后将所有wrap文件注册到lua虚拟机中。（ToLuaMenu.cs、ToLuaExport.cs、ToLuaTree.cs、LuaBinder.cs、CustomSetting.cs等）

**ToLuaMenu**：提供生成Wrap的方法

**CustomSetting**：设置供Wrap的文件

**LuaBinder**：启动虚拟机时注册wrap

提供c#对象和lua userdata对应关系，使该userdata能访问对应c#对象属性，调用对应c#对象函数。lua支持一定的面向对象(类、继承)。管理这些对象的内存分配与生命周期、GC。(LuaState.cs）提供支持功能Lua Coroutine、反射等，Lua层重写部分性能有问题对象如Vector系列。（Vector3.lua等）

### **启动**

```C#
mLuaState = new LuaState();
mLuaState.Start();
LuaBinder.Bind(mLuaState);
```

启动1.1 : ObjectTranslator缓存lua需要访问的C# object对象。添加、查询、删除、管理生命周期







***

### 资料

[ToLua源码分析：启动流程](https://blog.csdn.net/lodypig/article/details/60160020)

[Unity ToLua & LuaFramework_UGUI学习笔记](https://www.jianshu.com/p/ef1e2641e0c6)

***





## LuaKit



