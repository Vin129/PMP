### Shader

#### 渲染管线：

​	渲染流程主要分为三个阶段，由CPU与GPU完成

##### 1.应用阶段（cpu部分）

此阶段主要是处理数据（硬盘——>内存），设置渲染状态，DrawCall

###### 加载数据到显存

###### 设置渲染状态

###### DrawCall

​	将准备的数据（点，线，面，材质，等信息打包传递给GPU【图元数据】，通知GPU开始渲染）

##### 2.几何阶段（gpu）

该阶段主要做的事情是坐标转换，将空间坐标转换为屏幕坐标。

细分下来有如下几个过程：

###### 顶点着色器

###### 曲面着色器

###### 几何着色器

###### 剪裁

###### 屏幕映射

##### 3.光栅化阶段（gpu）

设置三角面，计算每个像素的颜色，最终呈现。

###### 三角形设置

###### 三角形遍历

###### 片元着色器

###### 逐片元操作



#### 数学

##### 向量/矢量v(x,y,z)

###### 点积

$$
\vec {v}_1\cdot \vec {v}_2 = {x}_1\times {x}_2 + {y}_1\times {y}_2 + {z}_1\times {z}_2
\vec {v}_1\cdot \vec {v}_2 = |\vec {v}_1||\vec {v}_2|\cosθ
$$

​	v1 在v2上的投影长度 （>0 方向相同 反之）
$$
θ = \arccos(\frac{\vec {v}_1}{|\vec {v}_1|}\cdot\frac{\vec {v}_2}{|\vec {v}_2|})
$$

###### 叉积

$$
\vec {v}_1 \times \vec {v}_2 = ({y}_1{z}_2 - {z}_1{y}_2,{z}_1{x}_2 - {x}_1{z}_2,{y}_1{x}_2 - {x}_2{y}_1)
$$

向量叉积来计算垂直于该平面的向量
$$
|\vec {v}_1 \times \vec {v}_2| = |\vec {v}_1||\vec {v}_2|\sinθ
$$



##### 矩阵

###### 单位矩阵

$$
{I}_n =  \begin{matrix}
   1 & 0 & 0 &. \\
   0 & 1 & 0 &. \\
   0 & 0 & 1 &.\\
   .&.&.&.n
  \end{matrix}
$$
###### 置换矩阵

$$
{M^T}_{ij} = {M}_{ji}
$$
###### 逆矩阵

$$
{M}{M^{-1}} = {I}
$$
###### 正交矩阵

$$
MM^T = I\\
M^T = M^{-1}
$$

$$
正交矩阵 M =  \begin{matrix}
    & \vec a &\\
    & \vec b &\\
   	& \vec c &\\
  \end{matrix}
  \vec a、 \vec b、  \vec c 单位矢量，互相垂直
$$

##### 矩阵变换

###### 基础变化矩阵

$$
\begin{matrix}
    {M}_{3*3} & {t}_{3*1} &\\
    {0}_{1*3} & {1} &\\
  \end{matrix}
$$



#### Unity Shader

##### 四种Shader

 1. Standard Surface Shader  表面着色器模板（Unity后台转换为顶点/片元着色器）

    ```shaderlab
    Shader "Custom/NewSurfaceShader" {
    	Properties {}
    	SubShader {
    		Tags { "RenderType"="Opaque" }
    		//[RenderSetup]
    		CGPROGRAM
    		ENDCG
    	}
    	FallBack "Diffuse"
    }
    ```

    

 2. Unlit Shader 顶点/片元着色器

    ```shaderlab
    Shader "Unlit/NewUnlitShader"
    {
    	Properties{}
    	SubShader
    	{
    		Tags { "RenderType"="Opaque" }
    		LOD 100
    		Pass
    		{
    			CGPROGRAM
    			ENDCG
    		}
    	}
    }
    ```

	3. Image Effect Shader 屏幕后处理效果模板

	4. Compute Shader  常规渲染流水线无关的计算

##### 第一个Shader

```shaderlab
Shader "Unlit/SimpleShader"
{
	SubShader
	{
		Pass
		{
				CGPROGRAM
				#pragma vertex vert
				#pragma fragment frag

				float4 vert(float4 v:POSITION):SV_POSITION
				{
					return UnityObjectToClipPos(v);//对顶点坐标进行了裁剪空间转换
				}

				fixed4 frag():SV_TARGET
				{
					return fixed4(1,1,0,1);
				}
				ENDCG	
		}
	}
}
```

###### vertex

​	声明了哪个函数包含顶点着色器代码

​	顶点着色器：逐顶点执行

###### fragment

​	声明了哪个函数包含了片元着色器代码

​	片元着色器：逐片元执行

###### 顶点与片元的关系

​	在渲染管线中，GPU执行的开始便是顶点作色器，它的输入来自CPU,主要工作是 **坐标转换**和**逐顶点光照**，且可以为后续阶段输出数据

​	片元着色器作用于光栅化阶段，三角形遍历阶段会检查每个像素是否被三角网络覆盖，如果被覆盖的话就会生成一个**片元**。





